<!doctype html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title> Classroom</title>
<style>
/* ===== COLORES Y FUENTES ===== */
:root{
  --yellow:#FFFF00;
  --orange:#FFA500;
  --text:#000000;
}

/* ===== BODY ===== */
body{
  margin:0;
  font-family: monospace;
  color: var(--text);
  text-align: center;
  background: linear-gradient(to bottom, #001f3f, #003366);
  position: relative;
}

/* ===== LOGO ===== */
#logo{
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 32px;
  font-weight: bold;
  color: #FFD700;
  text-shadow: 2px 2px 4px #000;
}

/* ===== TITULO ===== */
#title{
  font-size: 48px;
  color: #FFD700;
  text-shadow:
     2px 2px 0 #FF8C00,
     4px 4px 0 rgba(0,0,0,0.2);
  margin:0;
  padding-top: 10px;
}

/* ===== MENU ===== */
#menu{
  padding-top: 100px;
}

/* ===== BOTONES ===== */
button{
  font-size: 20px;
  font-weight: bold;
  padding: 16px 24px;
  margin: 12px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(to bottom, var(--yellow), var(--orange));
  color: black;
  cursor: pointer;
  box-shadow: 2px 4px 6px rgba(0,0,0,0.3);
  transition: transform 0.1s, box-shadow 0.1s;
}
button:hover{
  transform: translateY(-2px);
  box-shadow: 2px 6px 10px rgba(0,0,0,0.4);
}

/* ===== CANVAS ===== */
canvas{
  display:block;
  margin:20px auto;
  border:4px solid var(--text);
  background:#071;
  image-rendering: pixelated;
}

/* ===== INFO ===== */
#info{height:22px}

.small{
  font-size:12px;
  color:#ccc;
  margin-top:6px;
}

/* ===== OVERLAY ===== */
#overlay{
  position: fixed;
  left:0;
  top:0;
  width:100%;
  height:100%;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(146,141,141,0.81);
  z-index:50;
}
#overlay .panel{
  background:#D3D3D3;
  border:2px solid var(--text);
  padding:14px;
  text-align:center;
  color:white;
}
</style>
</head>
<body>

<!-- LOGO -->
<div id="logo">BG</div>

<!-- TITULO -->
<h1 id="title">üéÆ Mini Games 5x 2P</h1>

<!-- MENU -->
<div id="menu">
 <button onclick="startGame('futbolGame')">‚öΩ Fut25</button>
 <button onclick="startGame('pongGame')">üèìPong</button>
 <button onclick="startGame('tugGame')">ü™¢ Cuerda Clicker</button>
 <button onclick="startGame('shooterGame')">üî´ Shooter</button>
 <button onclick="startGame('f1Game')">üèéÔ∏è F1</button>
 <button onclick="startGame('nascarGame')">üöó NASCAR</button>
 <button onclick="startTournament()">üèÜ Torneo</button>
</div>

<!-- CANVAS -->
<canvas id="gameCanvas" width="900" height="560" style="display:none"></canvas>

<div id="info"></div>

<div class="small">
 Controles resumen:<br>
 F√∫tbol P1=WASD P2=Flechas | Pong P1=W/S P2=‚Üë/‚Üì 
 | Tug P1=A P2=L 
 | Shooter P1=WASD+F P2=Flechas+L | F1 P1:S/D P2:‚Üê/‚Üí 
 | NASCAR P1=A (tap) P2=L (tap) (W/‚Üë opcional base accel)
</div>

<!-- OVERLAY -->
<div id="overlay">
  <div class="panel">
    <div id="overlayText">PAUSA</div>
    <div style="margin-top:10px">
      <button onclick="resumeFromOverlay()">Reanudar (ESC)</button>
      <button onclick="restartCurrent()">Reiniciar</button>
      <button onclick="exitToMenu()">Salir al men√∫</button>
    </div>
  </div>
</div>

<script>
  function fx(){} 

/* ====== GLOBALS ====== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let keys = {};
let paused = false;
let currentGameRestart = null;
let gameLoopId = null;
const PER_GAME_TIME = 60*1000; // 1 min
let tournamentActive = false;
let tournamentState = {};

/* ====== UTILS ====== */
function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }
function rectsOverlap(a,b){ return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y; }

/* ====== INPUT ====== */
window.addEventListener('keydown', e => { keys[e.key] = true; if(e.key==='Escape') togglePause(); });
window.addEventListener('keyup', e => { keys[e.key] = false; });

function togglePause(){
  paused = !paused;
  document.getElementById('overlay').style.display = paused ? 'flex' : 'none';
}
function resumeFromOverlay(){ paused = false; document.getElementById('overlay').style.display='none'; }
function restartCurrent(){ if(currentGameRestart) currentGameRestart(); }
function exitToMenu(){ 
  paused=false;
  document.getElementById('menu').style.display='block';
  canvas.style.display='none';
  clearAnimation();
}

/* ====== GAME CONTROL ====== */
function clearAnimation(){ if(gameLoopId) cancelAnimationFrame(gameLoopId); gameLoopId=null; }

function runGame(gameName, onEnd, tournament=false){
  document.getElementById('menu').style.display='none';
  canvas.style.display='block';
  switch(gameName){
    case 'futbolGame': futbolGame(onEnd,tournament); break;
    case 'pongGame': pongGame(onEnd,tournament); break;
    case 'tugGame': tugGame(onEnd,tournament); break;
    case 'shooterGame': shooterGame(onEnd,tournament); break;
    case 'f1Game': f1Game(onEnd,tournament); break;
    case 'nascarGame': nascarGame(onEnd,tournament); break;
  }
}

function startGame(gameName){
  runGame(gameName, winner => {
    alert(winner ? `Ganador: ${winner}` : 'Empate');
    exitToMenu();
  });
}

/* ====== TOURNAMENT ====== */
function startTournament(){
 tournamentActive=true;
 clearAnimation();
 document.getElementById('menu').style.display='none';
 canvas.style.display='block';
 const games = ['futbolGame','pongGame','tugGame','shooterGame','f1Game','nascarGame'];
 tournamentState = {games, idx:0, points:{p1:0,p2:0}, perGameTime:PER_GAME_TIME};
 runNextTournamentGame();
}

function runNextTournamentGame(){
 if(!tournamentActive) return;
 if(tournamentState.idx >= tournamentState.games.length){ finishTournament(); return; }
 const g = tournamentState.games[tournamentState.idx];
 ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle='#439cc8ff'; ctx.font='26px monospace';
 ctx.fillText(`Torneo: ${g.toUpperCase()}`,220,260);
 setTimeout(()=>{
   runGame(g, (winner)=>{
     if(winner==='p1') tournamentState.points.p1 += 3;
     else if(winner==='p2') tournamentState.points.p2 += 3;
     else { tournamentState.points.p1 += 1; tournamentState.points.p2 += 1; }
     tournamentState.idx++;
     runNextTournamentGame();
   }, true);
 }, 800);
}

function finishTournament(){
 tournamentActive=false;
 ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle='#1d95ccff'; ctx.font='26px monospace';
 ctx.fillText('Torneo terminado',300,160);
 ctx.fillText(`Pts P1: ${tournamentState.points.p1}  Pts P2: ${tournamentState.points.p2}`,240,220);
 const p1 = tournamentState.points.p1, p2 = tournamentState.points.p2;
 let winnerText = (p1>p2) ? 'Jugador 1' : (p2>p1 ? 'Jugador 2' : '¬°Empate General!');
 ctx.fillStyle='yellow';
 ctx.fillText(`Ganador: ${winnerText}`,260,300);
 document.getElementById('info').textContent='Presiona ESC y luego Salir al men√∫';
}



/* ============== GAMES ============== */


/* ---------- 1) FUTBOL (max 1 minuto, gana al llegar 5 goles) ---------- */
function futbolGame(onEnd, tournament){
 clearAnimation();
 let ball = {x:450,y:280,vx:5,vy:3,r:18};
 let p1 = {x:260,y:240,w:48,h:48,score:0,color:'#66ccff'};
 let p2 = {x:540,y:240,w:48,h:48,score:0,color:'#ff7777'};
 const goalSize = 340;
 let goalie1 = {x:10,y:280,w:12,h:60, speed:1.2};
 let goalie2 = {x:878,y:280,w:12,h:60, speed:1.2};
 const font='18px monospace';
 let gameTimer = null;
 let finished = false;


 function endGame(winner){
   if(finished) return;
   finished = true;
   clearTimeout(gameTimer);
   if(onEnd) onEnd(winner);
   // stop loop
   cancelAnimationFrame(gameLoopId);
 }


 if(tournament) gameTimer = setTimeout(()=>{ // time up => tie
   endGame(null);
 }, PER_GAME_TIME);


 function drawField(){
   ctx.fillStyle='#083708';
   ctx.fillRect(0,0,900,560);
   for(let y=0;y<11;y++){
     ctx.fillStyle = y%2 ? '#073306' : '#083708';
     ctx.fillRect(0,y*50,900,25);
   }
   ctx.strokeStyle='white';
   ctx.lineWidth=2;
   ctx.strokeRect(0,0,900,560);
   ctx.beginPath(); ctx.moveTo(450,0); ctx.lineTo(450,560); ctx.stroke();
   ctx.beginPath(); ctx.arc(450,280,80,0,2*Math.PI); ctx.stroke();
   ctx.strokeRect(0,(560-goalSize)/2,18,goalSize); ctx.strokeRect(882,(560-goalSize)/2,18,goalSize);
 }
 function draw(){
   drawField();
   ctx.fillStyle='#cccccc';
   ctx.fillRect(goalie1.x,goalie1.y-goalie1.h/2,goalie1.w,goalie1.h);
   ctx.fillRect(goalie2.x,goalie2.y-goalie2.h/2,goalie2.w,goalie2.h);
   ctx.fillStyle=p1.color; ctx.fillRect(p1.x,p1.y,p1.w,p1.h);
   ctx.fillStyle=p2.color; ctx.fillRect(p2.x,p2.y,p2.w,p2.h);
   ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,2*Math.PI); ctx.fill();
   ctx.fillStyle='#7CFC00'; ctx.font=font; ctx.fillText(`P1: ${p1.score}   P2: ${p2.score}`, 380, 28);
   ctx.fillStyle='white'; ctx.font='12px monospace'; ctx.fillText('ESC pausa | Enter termina (torneo si aplica)',12,548);
 }
 function respawn(){
   ball.x=450; ball.y=280;
   ball.vx=(Math.random()>0.5?5:-5);
   ball.vy=(Math.random()>0.5?3:-3);
 }
 function update(){
   if(paused) return;
   // controls
   if(keys['w']) p1.y = clamp(p1.y-4,0,560-p1.h);
   if(keys['s']) p1.y = clamp(p1.y+4,0,560-p1.h);
   if(keys['a']) p1.x = clamp(p1.x-4,0,900-p1.w);
   if(keys['d']) p1.x = clamp(p1.x+4,0,900-p1.w);
   if(keys['ArrowUp']) p2.y = clamp(p2.y-4,0,560-p2.h);
   if(keys['ArrowDown']) p2.y = clamp(p2.y+4,0,560-p2.h);
   if(keys['ArrowLeft']) p2.x = clamp(p2.x-4,0,900-p2.w);
   if(keys['ArrowRight']) p2.x = clamp(p2.x+4,0,900-p2.w);


   ball.x += ball.vx; ball.y += ball.vy;
   if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; fx(200,0.04,'triangle',0.04); }
   if(ball.y + ball.r > 560){ ball.y = 560 - ball.r; ball.vy *= -1; fx(200,0.04,'triangle',0.04); }


   // goal check
   if(ball.x - ball.r <= 0){
     if(ball.y > (560-goalSize)/2 && ball.y < (560+goalSize)/2){
       p2.score++; fx(900,0.14,'sine',0.12); respawn();
     } else { ball.x = ball.r; ball.vx *= -1; fx(220,0.04,'square',0.04); }
   }
   if(ball.x + ball.r >= 900){
     if(ball.y > (560-goalSize)/2 && ball.y < (560+goalSize)/2){
       p1.score++; fx(900,0.14,'sine',0.12); respawn();
     } else { ball.x = 900 - ball.r; ball.vx *= -1; fx(220,0.04,'square',0.04); }
   }


   // collisions players
   [p1,p2].forEach(p=>{
     const cx = p.x + p.w/2, cy = p.y + p.h/2;
     const dx = ball.x - cx, dy = ball.y - cy;
     const dist = Math.hypot(dx,dy);
     const minDist = ball.r + Math.max(p.w,p.h)/2;
     if(dist < minDist){
       const angle = Math.atan2(dy,dx);
       const speed = Math.max(6, Math.hypot(ball.vx,ball.vy));
       ball.vx = Math.cos(angle)*speed; ball.vy = Math.sin(angle)*speed;
       ball.x = cx + Math.cos(angle)*(minDist+1); ball.y = cy + Math.sin(angle)*(minDist+1);
       fx(600,0.03,'triangle',0.05);
     }
   });


   // goalie AI (small & slow)
   if(ball.x < 380){
     if(Math.abs(goalie1.y - ball.y) > 4) goalie1.y += (ball.y > goalie1.y ? goalie1.speed : -goalie1.speed);
   } else { const center = 280; if(Math.abs(goalie1.y - center) > 1) goalie1.y += (center > goalie1.y ? 0.6 : -0.6); }
   if(ball.x > 520){
     if(Math.abs(goalie2.y - ball.y) > 4) goalie2.y += (ball.y > goalie2.y ? goalie2.speed : -goalie2.speed);
   } else { const center=280; if(Math.abs(goalie2.y - center) > 1) goalie2.y += (center > goalie2.y ? 0.6 : -0.6); }


   // keep ball inside
   const g1Box = {x:goalie1.x,y:goalie1.y-goalie1.h/2,w:goalie1.w,h:goalie1.h};
   const g2Box = {x:goalie2.x,y:goalie2.y-goalie2.h/2,w:goalie2.w,h:goalie2.h};
   if(ball.x - ball.r < g1Box.x + g1Box.w && ball.y > g1Box.y && ball.y < g1Box.y + g1Box.h){
     ball.x = g1Box.x + g1Box.w + ball.r; ball.vx = Math.abs(ball.vx); fx(350,0.04,'sine',0.05);
   }
   if(ball.x + ball.r > g2Box.x && ball.y > g2Box.y && ball.y < g2Box.y + g2Box.h){
     ball.x = g2Box.x - ball.r; ball.vx = -Math.abs(ball.vx); fx(350,0.04,'sine',0.05);
   }


   // win by score (first to 5)
   if(p1.score >= 5 || p2.score >= 5){
     const winner = p1.score>p2.score ? 'p1' : 'p2';
     endGame(winner);
     return;
   }


   // allow Enter to end early in tournament mode
   if(keys['Enter'] && onEnd){
     endGame(p1.score>p2.score?'p1':(p2.score>p1.score?'p2':null));
     return;
   }
 }


 currentGameRestart = ()=>{ ball={x:450,y:280,vx:5,vy:3,r:18}; p1.score=0; p2.score=0; goalie1.y=280; goalie2.y=280; finished=false; if(gameTimer){ clearTimeout(gameTimer); if(tournament) gameTimer = setTimeout(()=> endGame(null), PER_GAME_TIME); } };


 function loop(){ if(!paused) update(); draw(); gameLoopId = requestAnimationFrame(loop); }
 respawn(); loop();
}


/* ---------- 2) PONG (cada toque aumenta velocidad) ---------- */
function pongGame(onEnd,tournament){
 clearAnimation();
 let ball={x:450,y:280,vx:3,vy:2,r:8};
 let p1={x:40,y:230,w:15,h:110,score:0,color:'#00ffff'};
 let p2={x:845,y:230,w:15,h:110,score:0,color:'#ff00ff'};
 let gameTimer = null, finished=false;


 function endGame(winner){
   if(finished) return;
   finished=true;
   clearTimeout(gameTimer);
   if(onEnd) onEnd(winner);
   cancelAnimationFrame(gameLoopId);
 }
 if(tournament) gameTimer = setTimeout(()=>{ endGame(p1.score>p2.score?'p1':(p2.score>p1.score?'p2':null)); }, PER_GAME_TIME);


 function draw(){
   ctx.fillStyle='#000'; ctx.fillRect(0,0,900,560);
   ctx.strokeStyle='#7CFC00'; ctx.setLineDash([10,10]);
   ctx.beginPath(); ctx.moveTo(450,0); ctx.lineTo(450,560); ctx.stroke();
   ctx.setLineDash([]);
   ctx.fillStyle=p1.color; ctx.fillRect(p1.x,p1.y,p1.w,p1.h);
   ctx.fillStyle=p2.color; ctx.fillRect(p2.x,p2.y,p2.w,p2.h);
   ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(ball.x,ball.y,ball.r,0,2*Math.PI); ctx.fill();
   ctx.fillStyle='#7CFC00'; ctx.font='20px monospace'; ctx.fillText(`${p1.score} - ${p2.score}`,430,30);
 }
 function resetBall(){
   ball.x=450; ball.y=280; ball.vx=(Math.random()>0.5?3:-3); ball.vy=(Math.random()>0.5?2:-2);
 }
 function update(){
   if(paused) return;
   if(keys['w']) p1.y = clamp(p1.y-6,0,560-p1.h);
   if(keys['s']) p1.y = clamp(p1.y+6,0,560-p1.h);
   if(keys['ArrowUp']) p2.y = clamp(p2.y-6,0,560-p2.h);
   if(keys['ArrowDown']) p2.y = clamp(p2.y+6,0,560-p2.h);
   ball.x += ball.vx; ball.y += ball.vy;
   if(ball.y - ball.r < 0 || ball.y + ball.r > 560) { ball.vy *= -1; fx(200,0.03,'triangle',0.04); }
   if(ball.x - ball.r < p1.x + p1.w && ball.y > p1.y && ball.y < p1.y + p1.h){
     ball.x = p1.x + p1.w + ball.r; ball.vx = -ball.vx * 1.12; ball.vy *= 1.05; fx(500,0.02,'square',0.04);
   }
   if(ball.x + ball.r > p2.x && ball.y > p2.y && ball.y < p2.y + p2.h){
     ball.x = p2.x - ball.r; ball.vx = -ball.vx * 1.12; ball.vy *= 1.05; fx(500,0.02,'square',0.04);
   }
   if(ball.x < 0){ p2.score++; fx(880,0.08,'sine',0.08); resetBall(); }
   if(ball.x > 900){ p1.score++; fx(880,0.08,'sine',0.08); resetBall(); }


   if(keys['Enter'] && onEnd){ endGame(p1.score>p2.score?'p1':(p2.score>p1.score?'p2':null)); return; }
 }


 currentGameRestart = resetBall;
 function loop(){ if(!paused) update(); draw(); gameLoopId = requestAnimationFrame(loop); }
 resetBall(); loop();
}


/* ---------- 3) TUG (tira y afloja) ---------- */
function tugGame(onEnd, tournament){
 clearAnimation();
 let ropeX = 450, ropeSpeed=0, winner=null;
 const L=80, R=820;
 let gameTimer = null, finished=false;
 function endGame(w){ if(finished) return; finished=true; clearTimeout(gameTimer); if(onEnd) onEnd(w); cancelAnimationFrame(gameLoopId); }
 if(tournament) gameTimer = setTimeout(()=>{ endGame(null); }, PER_GAME_TIME);


 function draw(){
   ctx.fillStyle='#001200'; ctx.fillRect(0,0,900,560);
   ctx.fillStyle='#003300'; ctx.fillRect(0,240,900,80);
   ctx.strokeStyle='white'; ctx.lineWidth=6; ctx.beginPath(); ctx.moveTo(120,280); ctx.lineTo(780,280); ctx.stroke();
   ctx.fillStyle='#ffd700'; ctx.fillRect(ropeX-18,268,36,24);
   ctx.fillStyle='#66ccff'; ctx.fillRect(40,220,70,120);
   ctx.fillStyle='#ff6666'; ctx.fillRect(790,220,70,120);
   ctx.fillStyle='#7CFC00'; ctx.font='18px monospace';
   ctx.fillText(winner?`Ganador: ${winner}`:'P1: A | P2: L - mete r√°pido',220,40);
 }
 function update(){
   if(paused) return;
   if(keys['a']) ropeSpeed += 0.9;
   if(keys['l']) ropeSpeed -= 0.9;
   ropeSpeed *= 0.92;
   ropeX += ropeSpeed;
   ropeX = clamp(ropeX,0,900);
   if(ropeX <= L){ winner='Jugador 2'; fx(330,0.12,'sawtooth',0.12); endGame('p2'); }
   if(ropeX >= R){ winner='Jugador 1'; fx(660,0.12,'sawtooth',0.12); endGame('p1'); }
 }


 currentGameRestart = ()=>{ ropeX=450; ropeSpeed=0; winner=null; };
 function loop(){ if(!paused) update(); draw(); if(!winner) gameLoopId=requestAnimationFrame(loop); }
 loop();
}


/* ---------- 4) SHOOTER (1 min max, 3 vidas para perder) ---------- */
function shooterGame(onEnd,tournament){
 clearAnimation();
 let p1={x:120,y:240,w:26,h:26,color:'#66ccff',bullets:[],reload:0,lives:3};
 let p2={x:760,y:240,w:26,h:26,color:'#ff6666',bullets:[],reload:0,lives:3};
 const obstacles = [{x:380,y:160,w:140,h:24},{x:380,y:376,w:140,h:24}];
 const spawn = {p1:{x:120,y:240}, p2:{x:760,y:240}};
 let gameTimer = null, finished=false;


 function endGame(winner){
   if(finished) return;
   finished=true;
   clearTimeout(gameTimer);
   if(onEnd) onEnd(winner);
   cancelAnimationFrame(gameLoopId);
 }
 if(tournament) gameTimer = setTimeout(()=>{ endGame(p1.lives>p2.lives?'p1':(p2.lives>p1.lives?'p2':null)); }, PER_GAME_TIME);


 function draw(){
   ctx.fillStyle='#001'; ctx.fillRect(0,0,900,560);
   for(let i=0;i<18;i++){ ctx.fillStyle=i%2?'#011':'#002'; ctx.fillRect(0,i*31,900,15); }
   ctx.fillStyle='#666'; obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));
   ctx.fillStyle=p1.color; ctx.fillRect(p1.x,p1.y,p1.w,p1.h);
   ctx.fillStyle=p2.color; ctx.fillRect(p2.x,p2.y,p2.w,p2.h);
   ctx.fillStyle='yellow'; p1.bullets.forEach(b=>ctx.fillRect(b.x,b.y,8,4));
   ctx.fillStyle='orange'; p2.bullets.forEach(b=>ctx.fillRect(b.x,b.y,8,4));
   ctx.fillStyle='#7CFC00'; ctx.font='16px monospace'; ctx.fillText(`P1 Lives:${p1.lives}`,10,20); ctx.fillText(`P2 Lives:${p2.lives}`,800,20);
   ctx.fillStyle='white'; ctx.font='12px monospace'; ctx.fillText('WASD+F | Arrows+L | ESC pausa',300,540);
 }
 function moveWithObstacles(p,left,right,up,down){
   let nx=p.x, ny=p.y;
   if(keys[left]) nx-=4;
   if(keys[right]) nx+=4;
   if(keys[up]) ny-=4;
   if(keys[down]) ny+=4;
   nx = clamp(nx,0,900-p.w);
   ny = clamp(ny,0,560-p.h);
   const box={x:nx,y:ny,w:p.w,h:p.h};
   let collide=false;
   for(const o of obstacles) if(rectsOverlap(box,o)) { collide=true; break; }
   if(!collide){ p.x=nx; p.y=ny; }
 }
 function update(){
   if(paused) return;
   moveWithObstacles(p1,'a','d','w','s');
   moveWithObstacles(p2,'ArrowLeft','ArrowRight','ArrowUp','ArrowDown');
   if(keys['f'] && p1.reload<=0){ p1.bullets.push({x:p1.x+p1.w,y:p1.y+p1.h/2-2,vx:9}); p1.reload=12; fx(1200,0.04,'sine',0.06); }
   if(keys['l'] && p2.reload<=0){ p2.bullets.push({x:p2.x-8,y:p2.y+p2.h/2-2,vx:-9}); p2.reload=12; fx(900,0.04,'sine',0.06); }
   p1.reload--; p2.reload--;
   p1.bullets.forEach(b=>b.x+=b.vx); p2.bullets.forEach(b=>b.x+=b.vx);
   p1.bullets = p1.bullets.filter(b=> b.x<1000 && !obstacles.some(o=>b.x>o.x && b.x<o.x+o.w && b.y>o.y && b.y<o.y+o.h));
   p2.bullets = p2.bullets.filter(b=> b.x>-100 && !obstacles.some(o=>b.x>o.x && b.x<o.x+o.w && b.y>o.y && b.y<o.y+o.h));
   p1.bullets = p1.bullets.filter(b=>{
     if(b.x > p2.x && b.x < p2.x + p2.w && b.y > p2.y && b.y < p2.y + p2.h){
       p2.lives--; p2.x=spawn.p2.x; p2.y=spawn.p2.y; fx(220,0.06,'square',0.08); return false;
     } return true;
   });
   p2.bullets = p2.bullets.filter(b=>{
     if(b.x > p1.x && b.x < p1.x + p1.w && b.y > p1.y && b.y < p1.y + p1.h){
       p1.lives--; p1.x=spawn.p1.x; p1.y=spawn.p1.y; fx(220,0.06,'square',0.08); return false;
     } return true;
   });
   if(p1.lives<=0 || p2.lives<=0){
     const winner = p1.lives<=0 ? 'p2' : 'p1';
     endGame(winner);
     return;
   }
   if(keys['Enter'] && onEnd){ endGame(p1.lives>p2.lives?'p1':(p2.lives>p1.lives?'p2':null)); return; }
 }


 currentGameRestart = ()=>{ p1.x=spawn.p1.x;p1.y=spawn.p1.y;p1.lives=3;p1.bullets=[]; p1.reload=0; p2.x=spawn.p2.x;p2.y=spawn.p2.y;p2.lives=3;p2.bullets=[]; p2.reload=0; };


 function frame(){ if(!paused) update(); draw(); gameLoopId=requestAnimationFrame(frame); }
 frame();
}


/* ---------- 5) F1 (recta, gana si el otro pierde 3 vidas o al completar distancia) ---------- */
function f1Game(onEnd,tournament){
 clearAnimation();
 let p1={x:340,y:480,w:18,h:32,color:'#66ccff',lives:3};
 let p2={x:520,y:480,w:18,h:32,color:'#ff66a6',lives:3};
 let obstacles=[]; let scroll=0; let distance=0; const finish=3500;
 function gen(){ obstacles=[]; for(let i=0;i<120;i++){ const x=260+Math.random()*380; const y=-i*120 - Math.random()*200; obstacles.push({x,y,w:34,h:16}); } }
 gen();
 let gameTimer = null, finished=false;
 function endGame(winner){ if(finished) return; finished=true; clearTimeout(gameTimer); if(onEnd) onEnd(winner); cancelAnimationFrame(gameLoopId); }
 if(tournament) gameTimer = setTimeout(()=>{ endGame(p1.lives>p2.lives?'p1':(p2.lives>p1.lives?'p2':null)); }, PER_GAME_TIME);


 function draw(){
   ctx.fillStyle='#081'; ctx.fillRect(0,0,900,560);
   ctx.fillStyle='#444'; ctx.fillRect(240,0,420,560);
   ctx.strokeStyle='white'; ctx.setLineDash([20,20]);
   ctx.beginPath(); ctx.moveTo(450,0); ctx.lineTo(450,560); ctx.stroke();
   ctx.setLineDash([]);
   ctx.fillStyle='#777'; obstacles.forEach(o=>ctx.fillRect(o.x, o.y+scroll, o.w, o.h));
   ctx.fillStyle=p1.color; ctx.fillRect(p1.x,p1.y,p1.w,p1.h);
   ctx.fillStyle=p2.color; ctx.fillRect(p2.x,p2.y,p2.w,p2.h);
   ctx.fillStyle='#7CFC00'; ctx.font='16px monospace';
   ctx.fillText(`Dist: ${Math.floor(distance)}/${finish}`,360,28);
   ctx.fillText(`P1:${p1.lives}`,20,28); ctx.fillText(`P2:${p2.lives}`,820,28);
 }
 function update(){
   if(paused) return;
   if(keys['s']) p1.x = clamp(p1.x-4, 250, 640 - p1.w);
   if(keys['d']) p1.x = clamp(p1.x+4, 250, 640 - p1.w);
   if(keys['ArrowLeft']) p2.x = clamp(p2.x-4, 250, 640 - p2.w);
   if(keys['ArrowRight']) p2.x = clamp(p2.x+4, 250, 640 - p2.w);
   const speed = 6;
   distance += speed; scroll += speed;
   for(let i=0;i<obstacles.length;i++){
     const o = obstacles[i]; const oy = o.y + scroll;
     if(oy > -60 && oy < 620){
       if(rectsOverlap({x:p1.x,y:p1.y,w:p1.w,h:p1.h},{x:o.x,y:oy,w:o.w,h:o.h})){ p1.lives--; obstacles.splice(i,1); i--; p1.x=340; fx(200,0.06,'square',0.08); if(p1.lives<=0){ endGame('p2'); return; } }
       if(rectsOverlap({x:p2.x,y:p2.y,w:p2.w,h:p2.h},{x:o.x,y:oy,w:o.w,h:o.h})){ p2.lives--; obstacles.splice(i,1); i--; p2.x=520; fx(200,0.06,'square',0.08); if(p2.lives<=0){ endGame('p1'); return; } }
     }
   }
   if(distance >= finish){
     const winner = p1.lives>p2.lives?'p1':(p2.lives>p1.lives?'p2':null);
     endGame(winner);
     return;
   }
   if(keys['Enter'] && onEnd){ endGame(p1.lives>p2.lives?'p1':(p2.lives>p1.lives?'p2':null)); return; }
 }


 currentGameRestart = ()=>{ p1.x=340;p1.lives=3; p2.x=520;p2.lives=3; distance=0; scroll=0; gen(); };
 function frame(){ if(!paused) update(); draw(); gameLoopId=requestAnimationFrame(frame); }
 frame();
}





/* ---------- 6) NASCAR (ellipse laps, gana al completar lapsToWin) ---------- */
function nascarGame(onEnd, tournament){
 clearAnimation();
 const cx = 450, cy = 280;
 const rxOuter = 320, ryOuter = 180;
 const rxInner = 180, ryInner = 90;
 const lapsToWin = 3;
 let car1 = {angle:-Math.PI/2, baseSpeed:0.9, boost:0, color:'#66ccff', laps:0, lastCross:false};
 let car2 = {angle:-Math.PI/2+0.3, baseSpeed:0.9, boost:0, color:'#ff99aa', laps:0, lastCross:false};
 let lastClickTime = {p1:0, p2:0}, clickCount = {p1:0, p2:0}; const clickWindow = 400;
 let gameTimer = null, finished=false;


 function endGame(winner){
   if(finished) return;
   finished=true;
   clearTimeout(gameTimer);
   // remove key handler
   safeRemoveEventListener(window,'keydown',nascarKeyHandler);
   if(onEnd) onEnd(winner);
   cancelAnimationFrame(gameLoopId);
 }


 if(tournament) gameTimer = setTimeout(()=>{ const winner = car1.laps > car2.laps ? 'p1' : (car2.laps > car1.laps ? 'p2' : null); endGame(winner); }, PER_GAME_TIME);


 function posFor(angle){
   const rxMid = (rxOuter + rxInner) / 2;
   const ryMid = (ryOuter + ryInner) / 2;
   return { x: cx + Math.cos(angle) * rxMid, y: cy + Math.sin(angle) * ryMid };
 }


 function nascarKeyHandler(e){
   if(e.key === 'a'){
     const now = performance.now();
     if(now - lastClickTime.p1 < clickWindow) clickCount.p1++; else clickCount.p1 = 1;
     lastClickTime.p1 = now;
     car1.boost += 0.8 + Math.min(4, clickCount.p1 * 0.6);
     fx(900,0.03,'square',0.06);
   }
   if(e.key === 'l'){
     const now = performance.now();
     if(now - lastClickTime.p2 < clickWindow) clickCount.p2++; else clickCount.p2 = 1;
     lastClickTime.p2 = now;
     car2.boost += 0.8 + Math.min(4, clickCount.p2 * 0.6);
     fx(700,0.03,'square',0.06);
   }
   // optional: hold W/ArrowUp to slightly raise base speed
   if(e.key === 'w'){ car1.baseSpeed = Math.min(8, car1.baseSpeed + 0.02); }
   if(e.key === 'ArrowUp'){ car2.baseSpeed = Math.min(8, car2.baseSpeed + 0.02); }
 }
 window.addEventListener('keydown', nascarKeyHandler);


 currentGameRestart = ()=>{ car1 = {angle:-Math.PI/2, baseSpeed:0.9, boost:0, color:'#66ccff', laps:0, lastCross:false}; car2 = {angle:-Math.PI/2+0.3, baseSpeed:0.9, boost:0, color:'#ff99aa', laps:0, lastCross:false}; lastClickTime = {p1:0,p2:0}; clickCount = {p1:0,p2:0}; };


 function drawTrack(){
   ctx.fillStyle = '#022'; ctx.fillRect(0,0,900,560);
   ctx.beginPath(); ctx.ellipse(cx,cy,rxOuter,ryOuter,0,0,2*Math.PI); ctx.fillStyle='#222'; ctx.fill();
   ctx.globalCompositeOperation = 'destination-out';
   ctx.beginPath(); ctx.ellipse(cx,cy,rxInner,ryInner,0,0,2*Math.PI); ctx.fill();
   ctx.globalCompositeOperation = 'source-over';
   ctx.strokeStyle = 'white'; ctx.lineWidth = 3; ctx.setLineDash([6,6]);
   ctx.beginPath(); ctx.ellipse(cx,cy,(rxOuter+rxInner)/2,(ryOuter+ryInner)/2,0,0,2*Math.PI); ctx.stroke();
   ctx.setLineDash([]);
 }
 function drawCars(){
   const p1pos = posFor(car1.angle), p2pos = posFor(car2.angle);
   ctx.save(); ctx.translate(p1pos.x,p1pos.y); ctx.rotate(car1.angle); ctx.fillStyle = car1.color; ctx.fillRect(-10,-6,20,12); ctx.restore();
   ctx.save(); ctx.translate(p2pos.x,p2pos.y); ctx.rotate(car2.angle); ctx.fillStyle = car2.color; ctx.fillRect(-10,-6,20,12); ctx.restore();
   ctx.fillStyle='#7CFC00'; ctx.font='16px monospace';
   ctx.fillText(`P1 Laps: ${car1.laps}`, 12, 20); ctx.fillText(`P2 Laps: ${car2.laps}`, 760, 20);
   ctx.fillText(`P1 Speed:${(car1.baseSpeed + car1.boost).toFixed(2)}`, 12, 40); ctx.fillText(`P2 Speed:${(car2.baseSpeed + car2.boost).toFixed(2)}`, 760, 40);
 }


 function update(){
   if(paused) return;
   car1.boost *= 0.985; car2.boost *= 0.985;
   if(keys['w']) car1.baseSpeed = Math.min(8, car1.baseSpeed + 0.02); else car1.baseSpeed = Math.max(0.6, car1.baseSpeed - 0.01);
   if(keys['ArrowUp']) car2.baseSpeed = Math.min(8, car2.baseSpeed + 0.02); else car2.baseSpeed = Math.max(0.6, car2.baseSpeed - 0.01);
   const eff1 = car1.baseSpeed + car1.boost; const eff2 = car2.baseSpeed + car2.boost;
   car1.angle += 0.0018 * eff1; car2.angle += 0.0018 * eff2;


   function checkLap(car){
     const target = -Math.PI/2;
     const diff = ((car.angle - target + Math.PI*3) % (Math.PI*2)) - Math.PI;
     const near = Math.abs(diff) < 0.05;
     if(near && !car.lastCross){ car.laps++; fx(1000,0.06,'sine',0.06); }
     car.lastCross = near;
   }
   checkLap(car1); checkLap(car2);


   if(car1.laps >= lapsToWin || car2.laps >= lapsToWin){
     const winner = car1.laps > car2.laps ? 'p1' : (car2.laps > car1.laps ? 'p2' : null);
     safeRemoveEventListener(window,'keydown',nascarKeyHandler);
     endGame(winner);
     return;
   }


   if(keys['Enter'] && onEnd){
     const winner = car1.laps>car2.laps?'p1':(car2.laps>car1.laps?'p2':null);
     safeRemoveEventListener(window,'keydown',nascarKeyHandler);
     endGame(winner);
     return;
   }
 }


 function frame(){ drawTrack(); update(); drawCars(); gameLoopId = requestAnimationFrame(frame); }
 frame();
}


/* ============== END GAMES ============== */


</script>
</body>
</html>
